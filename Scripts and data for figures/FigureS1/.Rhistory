setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure4")
library(ggplot2)
library(ggpubr)
library(VennDiagram)
library(wesanderson)
library(data.table)
library(dplyr)
library(tidyr)
library(cowplot)
library(ggvenn)
library(ggsci)
library(ggrepel)
# Figure 6A
ListStrains = list(`Head`=unique(TE_chim_global[TE_chim_global$tissue=="head",]$TEfamily),
`Gut`=unique(TE_chim_global[TE_chim_global$tissue=="gut",]$TEfamily),
`Ovary`=unique(TE_chim_global[TE_chim_global$tissue=="ovary",]$TEfamily))
ggvenn(ListStrains,
stroke_size = 0.5, set_name_size = 4,fill_alpha=0.4,stroke_alpha = 1,stroke_color=NA ) + ggtitle("Shared TE families") + scale_fill_viridis_d()
f4a<-plot(euler(ListStrains[c("Head","Gut","Ovary")]),
quantities = list(type = c("counts"), cex = 1.2), labels = list(cex = 1.2),
edges = list(col = NA),
fills =list(fill = c("#386cb0","#fdb462","#7fc97f"), alpha = 0.5)  ,
main = list(label="Shared TE families across body parts", font = 2, cex = 1.3) )
createVD_3g(dataList = listTissues, filename = "~/Desktop/VD_by_tissue.png", mainTitle = "Shared chimeric gene-TE transcripts across body parts", ngroups = 3, category.names =names(listTissues))
# Figure 6B
occurrencesTE$label <- scales::percent(occurrencesTE$per, accuracy = 0.1)
f4b<-ggplot(occurrencesTE) + geom_col(width=1, aes(x="",y=per,fill=Category)) + coord_polar("y", start=0) +
theme_void() + scale_fill_rickandmorty() + geom_label_repel(aes(x="",y= cumsum(per) - per/2,label = label), size=4, show.legend = F, max.overlaps = 13, nudge_x = 0.1) +  ggtitle("TE family distribution across chimeric genes") +  theme(plot.title = element_text(face = "bold")) +
theme(plot.title = element_text(hjust = 0.5)) + labs(fill="TE superfamily")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
# Figure 6C
f4c<-ggplot(dataplotTE , aes(x=exonPosDescription, fill=Order)) + geom_bar(position="fill") + facet_grid(.~tissue) + theme_Publication() + scale_colour_Publication()  + labs(x = "", y = "Proportion of gene-TE chimeric genes")+scale_fill_manual(values=c("#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948")) +#+scale_fill_tableau()
scale_y_continuous(labels=scales::percent) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"))  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plots <- align_plots(f4a, f4c, align = 'v', axis = 'l')
# then build the bottom row
top_row <- plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
# then combine with the top row for final plot
plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5))
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 16, height = 7)
library(eulerr)
# Figure 6A
ListStrains = list(`Head`=unique(TE_chim_global[TE_chim_global$tissue=="head",]$TEfamily),
`Gut`=unique(TE_chim_global[TE_chim_global$tissue=="gut",]$TEfamily),
`Ovary`=unique(TE_chim_global[TE_chim_global$tissue=="ovary",]$TEfamily))
ggvenn(ListStrains,
stroke_size = 0.5, set_name_size = 4,fill_alpha=0.4,stroke_alpha = 1,stroke_color=NA ) + ggtitle("Shared TE families") + scale_fill_viridis_d()
f4a<-plot(euler(ListStrains[c("Head","Gut","Ovary")]),
quantities = list(type = c("counts"), cex = 1.2), labels = list(cex = 1.2),
edges = list(col = NA),
fills =list(fill = c("#386cb0","#fdb462","#7fc97f"), alpha = 0.5)  ,
main = list(label="Shared TE families across body parts", font = 2, cex = 1.3) )
createVD_3g(dataList = listTissues, filename = "~/Desktop/VD_by_tissue.png", mainTitle = "Shared chimeric gene-TE transcripts across body parts", ngroups = 3, category.names =names(listTissues))
# Figure 6B
occurrencesTE$label <- scales::percent(occurrencesTE$per, accuracy = 0.1)
f4b<-ggplot(occurrencesTE) + geom_col(width=1, aes(x="",y=per,fill=Category)) + coord_polar("y", start=0) +
theme_void() + scale_fill_rickandmorty() + geom_label_repel(aes(x="",y= cumsum(per) - per/2,label = label), size=4, show.legend = F, max.overlaps = 13, nudge_x = 0.1) +  ggtitle("TE family distribution across chimeric genes") +  theme(plot.title = element_text(face = "bold")) +
theme(plot.title = element_text(hjust = 0.5)) + labs(fill="TE superfamily")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
# Figure 6C
f4c<-ggplot(dataplotTE , aes(x=exonPosDescription, fill=Order)) + geom_bar(position="fill") + facet_grid(.~tissue) + theme_Publication() + scale_colour_Publication()  + labs(x = "", y = "Proportion of gene-TE chimeric genes")+scale_fill_manual(values=c("#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948")) +#+scale_fill_tableau()
scale_y_continuous(labels=scales::percent) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"))  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plots <- align_plots(f4a, f4c, align = 'v', axis = 'l')
# then build the bottom row
top_row <- plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
# then combine with the top row for final plot
plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5))
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 16, height = 7)
library(eulerr)
# Figure 6A
ListStrains = list(`Head`=unique(TE_chim_global[TE_chim_global$tissue=="head",]$TEfamily),
`Gut`=unique(TE_chim_global[TE_chim_global$tissue=="gut",]$TEfamily),
`Ovary`=unique(TE_chim_global[TE_chim_global$tissue=="ovary",]$TEfamily))
ggvenn(ListStrains,
stroke_size = 0.5, set_name_size = 4,fill_alpha=0.4,stroke_alpha = 1,stroke_color=NA ) + ggtitle("Shared TE families") + scale_fill_viridis_d()
f4a<-plot(euler(ListStrains[c("Head","Gut","Ovary")]),
quantities = list(type = c("counts"), cex = 1.2), labels = list(cex = 1.2),
edges = list(col = NA),
fills =list(fill = c("#386cb0","#fdb462","#7fc97f"), alpha = 0.5)  ,
main = list(label="Shared TE families across body parts", font = 2, cex = 1.3) )
createVD_3g(dataList = listTissues, filename = "~/Desktop/VD_by_tissue.png", mainTitle = "Shared chimeric gene-TE transcripts across body parts", ngroups = 3, category.names =names(listTissues))
# Figure 6B
occurrencesTE$label <- scales::percent(occurrencesTE$per, accuracy = 0.1)
f4b<-ggplot(occurrencesTE) + geom_col(width=1, aes(x="",y=per,fill=Category)) + coord_polar("y", start=0) +
theme_void() + scale_fill_rickandmorty() + geom_label_repel(aes(x="",y= cumsum(per) - per/2,label = label), size=4, show.legend = F, max.overlaps = 13, nudge_x = 0.1) +  ggtitle("TE family distribution across chimeric genes") +  theme(plot.title = element_text(face = "bold")) +
theme(plot.title = element_text(hjust = 0.5)) + labs(fill="TE superfamily")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
# Figure 6C
f4c<-ggplot(dataplotTE , aes(x=exonPosDescription, fill=Order)) + geom_bar(position="fill") + facet_grid(.~tissue) + theme_Publication() + scale_colour_Publication()  + labs(x = "", y = "Proportion of gene-TE chimeric genes")+scale_fill_manual(values=c("#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948")) +#+scale_fill_tableau()
scale_y_continuous(labels=scales::percent) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"))  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plots <- align_plots(f4a, f4c, align = 'v', axis = 'l')
# then build the bottom row
top_row <- plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
# then combine with the top row for final plot
plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5))
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 12, height = 12)
library(eulerr)
# Figure 6A
ListStrains = list(`Head`=unique(TE_chim_global[TE_chim_global$tissue=="head",]$TEfamily),
`Gut`=unique(TE_chim_global[TE_chim_global$tissue=="gut",]$TEfamily),
`Ovary`=unique(TE_chim_global[TE_chim_global$tissue=="ovary",]$TEfamily))
ggvenn(ListStrains,
stroke_size = 0.5, set_name_size = 4,fill_alpha=0.4,stroke_alpha = 1,stroke_color=NA ) + ggtitle("Shared TE families") + scale_fill_viridis_d()
f4a<-plot(euler(ListStrains[c("Head","Gut","Ovary")]),
quantities = list(type = c("counts"), cex = 1.2), labels = list(cex = 1.2),
edges = list(col = NA),
fills =list(fill = c("#386cb0","#fdb462","#7fc97f"), alpha = 0.5)  ,
main = list(label="Shared TE families across body parts", font = 2, cex = 1.3) )
createVD_3g(dataList = listTissues, filename = "~/Desktop/VD_by_tissue.png", mainTitle = "Shared chimeric gene-TE transcripts across body parts", ngroups = 3, category.names =names(listTissues))
# Figure 6B
occurrencesTE$label <- scales::percent(occurrencesTE$per, accuracy = 0.1)
f4b<-ggplot(occurrencesTE) + geom_col(width=1, aes(x="",y=per,fill=Category)) + coord_polar("y", start=0) +
theme_void() + scale_fill_rickandmorty() + geom_label_repel(aes(x="",y= cumsum(per) - per/2,label = label), size=4, show.legend = F, max.overlaps = 13, nudge_x = 0.1) +  ggtitle("TE family distribution across chimeric genes") +  theme(plot.title = element_text(face = "bold")) +
theme(plot.title = element_text(hjust = 0.5)) + labs(fill="TE superfamily")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
# Figure 6C
f4c<-ggplot(dataplotTE , aes(x=exonPosDescription, fill=Order)) + geom_bar(position="fill") + facet_grid(.~tissue) + theme_Publication() + scale_colour_Publication()  + labs(x = "", y = "Proportion of gene-TE chimeric genes")+scale_fill_manual(values=c("#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948")) +#+scale_fill_tableau()
scale_y_continuous(labels=scales::percent) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"))  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plots <- align_plots(f4a, f4c, align = 'v', axis = 'l')
# then build the bottom row
top_row <- plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
# then combine with the top row for final plot
plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5))
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 12, height = 10)
occurrencesTE$label <- scales::percent(occurrencesTE$per, accuracy = 0.1)
f4b<-ggplot(occurrencesTE) + geom_col(width=1, aes(x="",y=per,fill=Category)) + coord_polar("y", start=0) +
theme_void() + scale_fill_rickandmorty() + geom_label_repel(aes(x="",y= cumsum(per) - per/2,label = label), size=4, show.legend = F, max.overlaps = 15, nudge_x = 0.1) +  ggtitle("TE family distribution across chimeric genes") +  theme(plot.title = element_text(face = "bold")) +
theme(plot.title = element_text(hjust = 0.5)) + labs(fill="TE superfamily")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
# Figure 6C
f4c<-ggplot(dataplotTE , aes(x=exonPosDescription, fill=Order)) + geom_bar(position="fill") + facet_grid(.~tissue) + theme_Publication() + scale_colour_Publication()  + labs(x = "", y = "Proportion of gene-TE chimeric genes")+scale_fill_manual(values=c("#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948")) +#+scale_fill_tableau()
scale_y_continuous(labels=scales::percent) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"))  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plots <- align_plots(f4a, f4c, align = 'v', axis = 'l')
# then build the bottom row
top_row <- plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
# then combine with the top row for final plot
plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5))
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 12, height = 12)
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 10, height = 10)
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 11, height = 10)
ggsave(plot_grid(top_row, f4c, labels = c('', 'C'), label_size = 18, ncol = 1, rel_heights = c(1,1.5)),file="Figure4.png", width = 12, height = 10)
plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
plot_grid(plots[[1]], f4b, align = "vh", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
plot_grid(plots[[1]], f4b, align = "vh", axis = "tb", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
plot_grid(plots[[1]], f4b, align = "vh", axis = "b", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.5))
plot_grid(plots[[1]], f4b, align = "vh", axis = "b", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8))
plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8))
plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8), rel_heights = c(1,1.2))
plot_grid(plots[[1]], f4b, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8), rel_heights = c(1,0.6))
plot_grid(plots[[1]], f4b, align = "h", axis = "c", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8), rel_heights = c(1,0.6))
plot_grid(plots[[1]], f4b, align = "h", axis = "b", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8), rel_heights = c(1,0.6))
plot_grid(plots[[1]], f4b, align = "h", axis = "b", labels = c('A', 'B'), label_size = 18, rel_widths = c(1,1.8), rel_heights = c(1,0.3))
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure 5")
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure5")
load("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure5/Figure5.RData")
plot_grid(plotA, plotB, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
plotA<-ggplot(df.expression.comparison.figure2, aes(x=status, y = log2(avgExpr))) + geom_boxplot(fill=c("#FF6A6A", "#FF6A6A", "firebrick3", "gray80")) + theme_Publication() + labs(y=expression(log[2](TMM)),x="")  + coord_flip() +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))
plotB<-gplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)
plot_grid(plotA, plotB, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
plotB<-ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)
plot_grid(plotA, plotB, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
plotA
plotB
ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)
averageGeneExpressionContribution
ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication()
ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication()
averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100
]
averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]
class(averageGeneExpressionContribution)
type(averageGeneExpressionContribution)
str(averageGeneExpressionContribution)
colors
colors <- c(rep("deepskyblue3",29), rep("orange",1))
ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)
plotB<-ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)
plot_grid(plotA, plotB, align = "h", axis = "t", labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
,file="Figure5.png", width = 10, height = 10)
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
,file="Figure5.png", width = 8, height = 8)
plotA<-ggplot(df.expression.comparison.figure2, aes(x=status, y = log2(avgExpr))) + geom_boxplot(fill=c("#FF6A6A", "#FF6A6A", "firebrick3", "gray80")) + theme_Publication() + labs(y=expression(log[2](TMM)),x="")  + coord_flip() +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plotB<-ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of chimeric genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
,file="Figure5.png", width = 10, height = 10)
plotA<-ggplot(df.expression.comparison.figure2, aes(x=status, y = log2(avgExpr))) + geom_boxplot(fill=c("#FF6A6A", "#FF6A6A", "firebrick3", "gray80")) + theme_Publication() + labs(y=expression(log[2](TMM)),x="")  + coord_flip() +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plotB<-ggplot(averageGeneExpressionContribution,aes(x=Mean)) + geom_histogram(fill=colors, boundary = 0, closed = "left") + theme_Publication() + scale_fill_Publication() + geom_vline(xintercept=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean), linetype = "longdash") +  scale_y_continuous( expand = c(0, 0)) +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + labs(x="Mean chimeric gene-TE transcript expression contribution", y = "Number of chimeric genes") + geom_text(aes(x=median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),  y=200), label=paste0("\nMedian = ",round(median(averageGeneExpressionContribution[averageGeneExpressionContribution$Mean!=100,]$Mean),1),"%"), angle=90, check_overlap = TRUE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,2.5))
,file="Figure5.png", width = 10, height = 10)
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,2.5))
,file="Figure5.png", width = 8, height = 8)
ggsave(plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
,file="Figure5.png", width = 8, height = 8)
load("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure6/Figure6.RData")
dataGO_BP$enrichmentScore<-as.numeric(as.character(dataGO_BP$enrichmentScore))
GO_BP_plot <-ggplot(dataGO_BP, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0)  + scale_fill_manual(values=c("#E41A1C","#377EB8","#4DAF4A", "#984EA3")) +
theme(axis.text = element_text( size = 14)) + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)
dataGO_MF$enrichmentScore<-as.numeric(as.character(dataGO_MF$enrichmentScore))  + guides(fill=FALSE)
GO_MF_plot <-ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)
plotGO<-plot_grid(GO_BP_plot,GO_MF_plot,ncol=1,labels=c("A","B"),  align = 'v', axis = 'l')
plotGO
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5)
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure5")
GO_BP_plot <-ggplot(dataGO_BP, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0)  + scale_fill_manual(values=c("#E41A1C","#377EB8","#4DAF4A", "#984EA3")) +
theme(axis.text = element_text( size = 14)) + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
dataGO_MF$enrichmentScore<-as.numeric(as.character(dataGO_MF$enrichmentScore))  + guides(fill=FALSE)
GO_MF_plot <-ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plotGO<-plot_grid(GO_BP_plot,GO_MF_plot,ncol=1,labels=c("A","B"),  align = 'v', axis = 'l')
plotGO
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5)
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure5")
plot_grid(plotA, plotB, align = "h", axis = "t", nrow=2,labels = c('A', 'B'), label_size = 18, rel_heights =  c(1,3))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=16)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=2)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=8)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=4)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=6)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=5)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 14)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/Figure6")
dataGO_BP$enrichmentScore<-as.numeric(as.character(dataGO_BP$enrichmentScore))
GO_BP_plot <-ggplot(dataGO_BP, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0, size=5)  + scale_fill_manual(values=c("#E41A1C","#377EB8","#4DAF4A", "#984EA3")) +
theme(axis.text = element_text( size = 16)) + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
dataGO_MF$enrichmentScore<-as.numeric(as.character(dataGO_MF$enrichmentScore))  + guides(fill=FALSE)
GO_MF_plot <-ggplot(dataGO_MF, aes(y=enrichmentScore, x=shortName)) + geom_col(aes(fill=type),alpha=0.7) + coord_flip() + facet_grid(.~ tissue) + labs(x="", y = "Enrichment score", fill="Annotation cluster") + theme_Publication() + geom_text(aes(label = nGenes), hjust = 0,size=5)  + scale_fill_manual(values=c( "#FF7F00","#FFFF33","#A65628", "#999999","#F781BF")) +
theme(axis.text = element_text( size = 16)) +guides(fill=guide_legend(nrow=2,byrow=TRUE))  + scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) + guides(fill=FALSE)   +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
plotGO<-plot_grid(GO_BP_plot,GO_MF_plot,ncol=1,labels=c("A","B"),  align = 'v', axis = 'l')
plotGO
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5)
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5,label_size = 18,)
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5, label_size = 18)
plotGO<-plot_grid(GO_BP_plot,GO_MF_plot,ncol=1,labels=c("A","B"),  align = 'v', axis = 'l',label_size = 18)
plotGO
ggsave(filename = "Figure6.png", plotGO, width = 13, height = 6.5)
load("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/FigureS1/FigureS1.RData")
setwd("~/")
setwd("/run/user/1000/gvfs/sftp:host=marvin.s.upf.edu,user=mcoronado/gpfs42/robbyfs/homes/users/mcoronado/scratch/5GenomesProject/ANALYSES/trinity-repeatMasker/FIGURES/FigureS1")
epigA<-ggplot(epigResults[epigResults$change=="Loss of H3K27ac" | epigResults$change=="Loss of H3K9me3" | epigResults$change=="Gain of H3K27ac" | epigResults$change=="Gain of H3K9me3" | epigResults$change=="Gain of both",], aes(x=TEpresence, y =log2(avgExpr))) + geom_boxplot(aes(fill=TEpresence)) + facet_grid(.~change) + coord_flip() +
theme_Publication() + labs(y=expression(log[2](TMM)),x="",fill="") +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + scale_fill_manual(values=c("gray80", "firebrick3"), labels = c("Transcripts TE(-)","Transcripts TE(+)"))  + theme(
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +   scale_x_discrete(limits=rev)  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
epiGB<-ggplot(dfFC, aes(x=change,y=value,fill=variable)) + geom_col(position = "fill") + theme_Publication() + scale_fill_manual(values=c("cadetblue3","brown3","gray80"),breaks = c("FC_low", "FC_high"), labels = c("FC<1", "FC>1"),na.value="gray80") +labs(x="", y ="Percentage", fill="Fold-change") +   scale_y_continuous(breaks = brks, labels = scales::percent(brks))  + theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()) + geom_text(data=subset(dfFC, value!=0), aes( label = value), vjust = 1.5, position="fill")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
fig6<-plot_grid(epigA,epiGB,ncol=1,rel_heights = c(0.5,0.75), align = 'v', axis = 'l', labels="AUTO")
brks <- c(0, 0.25, 0.5, 0.75, 1)
epigA<-ggplot(epigResults[epigResults$change=="Loss of H3K27ac" | epigResults$change=="Loss of H3K9me3" | epigResults$change=="Gain of H3K27ac" | epigResults$change=="Gain of H3K9me3" | epigResults$change=="Gain of both",], aes(x=TEpresence, y =log2(avgExpr))) + geom_boxplot(aes(fill=TEpresence)) + facet_grid(.~change) + coord_flip() +
theme_Publication() + labs(y=expression(log[2](TMM)),x="",fill="") +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + scale_fill_manual(values=c("gray80", "firebrick3"), labels = c("Transcripts TE(-)","Transcripts TE(+)"))  + theme(
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +   scale_x_discrete(limits=rev)  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
epiGB<-ggplot(dfFC, aes(x=change,y=value,fill=variable)) + geom_col(position = "fill") + theme_Publication() + scale_fill_manual(values=c("cadetblue3","brown3","gray80"),breaks = c("FC_low", "FC_high"), labels = c("FC<1", "FC>1"),na.value="gray80") +labs(x="", y ="Percentage", fill="Fold-change") +   scale_y_continuous(breaks = brks, labels = scales::percent(brks))  + theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()) + geom_text(data=subset(dfFC, value!=0), aes( label = value), vjust = 1.5, position="fill")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
fig6<-plot_grid(epigA,epiGB,ncol=1,rel_heights = c(0.5,0.75), align = 'v', axis = 'l', labels="AUTO")
fig6
ggsave(filename = "FigureS1.png", fig6, width = 13, height = 6.5)
epigResults$change <- factor(epigResults$change, levels=c("Gain of H3K27ac", "Gain of H3K9me3", "Gain of both", "Loss of H3K27ac", "Loss of H3K9me3"))
epigA<-ggplot(epigResults[epigResults$change=="Loss of H3K27ac" | epigResults$change=="Loss of H3K9me3" | epigResults$change=="Gain of H3K27ac" | epigResults$change=="Gain of H3K9me3" | epigResults$change=="Gain of both",], aes(x=TEpresence, y =log2(avgExpr))) + geom_boxplot(aes(fill=TEpresence)) + facet_grid(.~change) + coord_flip() +
theme_Publication() + labs(y=expression(log[2](TMM)),x="",fill="") +  theme(panel.border = element_blank(), panel.grid.major = element_blank(),  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + scale_fill_manual(values=c("gray80", "firebrick3"), labels = c("Transcripts TE(-)","Transcripts TE(+)"))  + theme(
axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +   scale_x_discrete(limits=rev)  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
brks <- c(0, 0.25, 0.5, 0.75, 1)
epiGB<-ggplot(dfFC, aes(x=change,y=value,fill=variable)) + geom_col(position = "fill") + theme_Publication() + scale_fill_manual(values=c("cadetblue3","brown3","gray80"),breaks = c("FC_low", "FC_high"), labels = c("FC<1", "FC>1"),na.value="gray80") +labs(x="", y ="Percentage", fill="Fold-change") +   scale_y_continuous(breaks = brks, labels = scales::percent(brks))  + theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()) + geom_text(data=subset(dfFC, value!=0), aes( label = value), vjust = 1.5, position="fill")  +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), text = element_text(size=16), plot.title = element_text(size = 16))
fig6<-plot_grid(epigA,epiGB,ncol=1,rel_heights = c(0.5,0.75), align = 'v', axis = 'l', labels="AUTO")
ggsave(filename = "FigureS1.png", fig6, width = 13, height = 6.5)
